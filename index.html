<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUFIN|SUTAN FINANCE</title>
    <!-- Library untuk membuat chart/grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Impor font dari Google Fonts untuk tampilan yang lebih modern -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        /* Pengaturan variabel warna untuk konsistensi desain */
        :root {
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #212529;
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --border-color: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Styling untuk Header */
        header {
            text-align: center;
            margin-bottom: 20px;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0;
        }

        /* Navigasi Bulan */
        .month-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 40px;
            gap: 15px;
        }

        .month-navigation button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .month-navigation button:hover {
            background-color: #0056b3;
        }
        
        .month-navigation button:disabled {
            background-color: #c0c0c0;
            cursor: not-allowed;
        }

        #current-month-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            width: 220px; /* Sedikit lebih lebar untuk nama bulan panjang */
            text-align: center;
        }


        /* Styling untuk Dashboard Ringkasan */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .card h3 {
            margin-top: 0;
            font-size: 1rem;
            color: var(--secondary-color);
            font-weight: 600;
        }

        .card .amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card .amount.income { color: var(--success-color); }
        .card .amount.expense { color: var(--danger-color); }
        .card .amount.surplus { color: var(--primary-color); }
        .card .note {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }

        /* Styling untuk setiap seksi konten */
        .section {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .section h2 {
            font-size: 1.8rem;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        /* Styling untuk wadah grafik */
        .chart-container {
            position: relative;
            max-width: 400px;
            margin: 20px auto;
        }

        /* Styling untuk Tabel */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        td[contenteditable="true"] {
            cursor: text;
            background-color: #fefce8; /* Kuning muda untuk menandakan bisa diedit */
        }
        td[contenteditable="true"]:focus {
            background-color: #e7f1ff;
            outline: 2px solid var(--primary-color);
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }
        
        tfoot td {
            font-weight: 700;
            font-size: 1.1rem;
            background-color: #f8f9fa;
        }

        /* Styling untuk input yang bisa diedit */
        .editable-amount {
            border: 1px solid transparent;
            background-color: #fefce8; /* Kuning muda untuk menandakan bisa diedit */
            font-family: inherit;
            font-size: inherit;
            color: inherit;
            width: 100%;
            padding: 4px;
            border-radius: 4px;
            transition: border-color 0.2s, background-color 0.2s;
        }

        .editable-amount:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: #e7f1ff;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            line-height: 20px;
            text-align: center;
        }
        .delete-btn:hover {
            background-color: #fbebee;
        }

        .add-row-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 15px;
        }
        .add-row-btn:hover {
            background-color: #218838;
        }


        /* Styling untuk label status (Likuid, Ditunda, dll) */
        .status {
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.8rem;
            display: inline-block;
        }
        .status.likuid { background-color: #d4edda; color: #155724; }
        .status.non-likuid { background-color: #fff3cd; color: #856404; }
        .status.ditunda { background-color: #e2e3e5; color: #383d41; }

        /* Styling untuk seksi Rencana Aksi (SOP) */
        .sop-section { padding: 0; }
        .sop-item { padding: 20px; border-bottom: 1px solid var(--border-color); }
        .sop-item:last-child { border-bottom: none; }
        .sop-item h4 { margin: 0 0 10px 0; font-size: 1.1rem; color: var(--primary-color); }
        .sop-item ul { padding-left: 20px; margin: 0; color: var(--secondary-color); }
        .sop-item li { margin-bottom: 5px; }

        /* Styling untuk Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <div class="container">

        <header>
            <h1>Manajemen Keuangan</h1>
        </header>
        
        <nav class="month-navigation">
            <button id="prev-month-btn">â€¹ Sebelumnya</button>
            <h2 id="current-month-display"></h2>
            <button id="next-month-btn">Selanjutnya â€º</button>
        </nav>

        <!-- DASHBOARD RINGKASAN -->
        <section class="dashboard">
            <div class="card">
                <h3>Total Pemasukan Likuid</h3>
                <div class="amount income" id="total-pemasukan"></div>
                <div class="note" id="pemasukan-note"></div>
            </div>
            <div class="card">
                <h3>Anggaran Pengeluaran</h3>
                <div class="amount expense" id="total-pengeluaran"></div>
                <div class="note" id="pengeluaran-note"></div>
            </div>
            <div class="card">
                <h3>Sisa Kas (Surplus)</h3>
                <div class="amount surplus" id="sisa-kas"></div>
                <div class="note" id="sisa-kas-note"></div>
            </div>
        </section>

        <!-- SEKSI GRAFIK ALOKASI -->
        <section class="section">
            <h2>Alokasi Sisa Kas</h2>
            <div class="chart-container">
                <canvas id="allocationChart"></canvas>
            </div>
        </section>

        <!-- SEKSI RINCIAN PEMASUKAN -->
        <section class="section">
            <h2>Rincian Pemasukan & Dana Tersedia</h2>
            <table>
                <thead>
                    <tr>
                        <th>Sumber Pemasukan</th>
                        <th>Jumlah</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="income-table-body">
                    <!-- Data Pemasukan akan diisi oleh JavaScript -->
                </tbody>
                <tfoot id="income-table-foot">
                    <!-- Total Pemasukan akan diisi oleh JavaScript -->
                </tfoot>
            </table>
            <button class="add-row-btn" id="add-income-btn">+ Tambah Baris</button>
        </section>

        <!-- SEKSI RINCIAN PENGELUARAN -->
        <section class="section">
            <h2>Rincian Anggaran Pengeluaran</h2>
            <table>
                <thead>
                    <tr>
                        <th>Kategori</th>
                        <th>Item</th>
                        <th>Anggaran</th>
                        <th>Catatan</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="expense-table-body">
                     <!-- Data Pengeluaran akan diisi oleh JavaScript -->
                </tbody>
                <tfoot id="expense-table-foot">
                    <!-- Total Pengeluaran akan diisi oleh JavaScript -->
                </tfoot>
            </table>
            <button class="add-row-btn" id="add-expense-btn">+ Tambah Baris</button>
        </section>

        <!-- SEKSI RENCANA AKSI -->
         <section class="section sop-section" id="rencana-aksi-section">
            <h2>Rencana Aksi & Aturan Main</h2>
            <!-- Rencana Aksi akan diisi oleh JavaScript -->
        </section>
        
        <footer>
            <p>Dengan struktur ini, keuangan stabil dan siap bertumbuh.</p>
        </footer>

    </div>

    <!-- JavaScript untuk fungsionalitas dan data -->
    <script>
        // --- PUSAT DATA KEUANGAN ---
        // Data untuk 12 bulan dari September 2025 - Agustus 2026
        // Properti "monthName" sudah dihapus dan akan dibuat otomatis
        const financeData = {
            "2025-09": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' }, { sumber: 'Uang Kembali dari Teman', jumlah: 450000, status: 'likuid' }, { sumber: 'Cicilan dari Orang Tua', jumlah: 850000, status: 'non-likuid' } ],
                pengeluaran: [ { kategori: 'Bimbingan Skripsi', item: 'BBM NMAX (PP)', anggaran: 120000, catatan: 'Estimasi' }, { kategori: 'Bimbingan Skripsi', item: 'Penginapan Hemat', anggaran: 120000, catatan: 'Kos / Guesthouse' }, { kategori: 'Bimbingan Skripsi', item: 'Makan & Jajan', anggaran: 80000, catatan: '-' }, { kategori: 'Kebutuhan Pribadi', item: 'Potong Rambut', anggaran: 40000, catatan: 'Rutin' }, { kategori: 'Kebutuhan Pribadi', item: 'Skincare Basic', anggaran: 100000, catatan: 'FW, Cream, Sunscreen' }, { kategori: 'Internet & Digital', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Internet & Digital', item: 'Cetak Kartu blu', anggaran: 0, catatan: 'DITUNDA' }, { kategori: 'Sosialisasi', item: 'First Date', anggaran: 100000, catatan: 'Plafon Maksimal' } ],
                alokasi: [ { nama: 'Dana Kuliah', jumlah: 600000, warna: '#007bff' }, { nama: 'Investasi (RDPU)', jumlah: 200000, warna: '#28a745' }, { nama: 'Buffer Cash', jumlah: 40000, warna: '#ffc107' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Aturan Disiplin September', poin: ['Patuhi semua plafon pengeluaran.', 'Cicilan ortu wajib masuk ke dana kuliah.'] }, { judul: 'ðŸ“ˆ Target Oktober', poin: ['Mulai investasi rutin (DCA) Rp100k/bulan.'] } ]
            },
            "2025-10": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Lain-lain', item: 'Cetak Kartu blu', anggaran: 50000, catatan: 'Sesuai rencana' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 100000, catatan: 'Mulai rutin' }, { kategori: 'Lain-lain', item: 'Jajan & Tak terduga', anggaran: 100000, catatan: 'Buffer' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 500000, warna: '#007bff' }, { nama: 'Investasi Tambahan', jumlah: 160000, warna: '#28a745' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Oktober', poin: ['Disiplin investasi rutin (DCA).', 'Jaga pengeluaran tak terduga.'] }, { judul: 'ðŸ“ˆ Target November', poin: ['Naikkan DCA menjadi Rp150k.'] } ]
            },
            "2025-11": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 150000, catatan: 'Target baru' }, { kategori: 'Lain-lain', item: 'Jajan & Tak terduga', anggaran: 120000, catatan: 'Buffer' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 640000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama November', poin: ['Konsisten dengan DCA Rp150k.'] }, { judul: 'ðŸ“ˆ Target Desember', poin: ['Siapkan dana untuk liburan akhir tahun.'] } ]
            },
            "2025-12": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' }, { sumber: 'Bonus Akhir Tahun', jumlah: 250000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 150000, catatan: 'Rutin' }, { kategori: 'Kebutuhan Pribadi', item: 'Skincare', anggaran: 120000, catatan: 'Stok ulang' }, { kategori: 'Hiburan', item: 'Liburan Tahun Baru', anggaran: 300000, catatan: 'Budget' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 590000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Desember', poin: ['Nikmati liburan sesuai budget.', 'Alokasikan bonus dengan bijak.'] }, { judul: 'ðŸ“ˆ Target Januari', poin: ['Kembali ke rutinitas hemat.'] } ]
            },
            "2026-01": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 150000, catatan: 'Rutin' }, { kategori: 'Lain-lain', item: 'Jajan & Tak terduga', anggaran: 100000, catatan: 'Buffer' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 660000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Januari', poin: ['Memulai tahun dengan disiplin keuangan.'] }, { judul: 'ðŸ“ˆ Target Februari', poin: ['Siapkan dana untuk servis motor.'] } ]
            },
            "2026-02": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 150000, catatan: 'Rutin' }, { kategori: 'Kendaraan', item: 'Servis Motor', anggaran: 150000, catatan: 'Rutin 6 bulan' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 610000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Februari', poin: ['Pastikan motor dalam kondisi prima.'] }, { judul: 'ðŸ“ˆ Target Maret', poin: ['Fokus menabung tanpa ada pengeluaran besar.'] } ]
            },
            "2026-03": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 150000, catatan: 'Rutin' }, { kategori: 'Kebutuhan Pribadi', item: 'Skincare', anggaran: 120000, catatan: 'Stok ulang' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 640000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Maret', poin: ['Persiapan menyambut bulan puasa.'] }, { judul: 'ðŸ“ˆ Target April', poin: ['Siapkan dana untuk kebutuhan Lebaran.'] } ]
            },
            "2026-04": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' }, { sumber: 'THR Kecil', jumlah: 300000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 150000, catatan: 'Rutin' }, { kategori: 'Hari Raya', item: 'Belanja Lebaran', anggaran: 400000, catatan: 'Baju & lain-lain' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 660000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama April', poin: ['Manfaatkan THR dengan baik.', 'Rayakan Lebaran dengan hemat.'] }, { judul: 'ðŸ“ˆ Target Mei', poin: ['Kembali ke pola pengeluaran normal.'] } ]
            },
            "2026-05": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 150000, catatan: 'Rutin' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 760000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Mei', poin: ['Evaluasi keuangan pasca Lebaran.'] }, { judul: 'ðŸ“ˆ Target Juni', poin: ['Cari peluang pemasukan tambahan.'] } ]
            },
            "2026-06": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' }, { sumber: 'Proyek Freelance', jumlah: 400000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 200000, catatan: 'Ditingkatkan' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 1110000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Juni', poin: ['Maksimalkan pendapatan freelance.', 'Tingkatkan porsi investasi.'] }, { judul: 'ðŸ“ˆ Target Juli', poin: ['Pertahankan momentum positif.'] } ]
            },
            "2026-07": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 200000, catatan: 'Konsisten' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 710000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Juli', poin: ['Jaga konsistensi investasi.'] }, { judul: 'ðŸ“ˆ Target Agustus', poin: ['Siapkan dana perpanjang STNK.'] } ]
            },
            "2026-08": {
                pemasukan: [ { sumber: 'Uang Saku Bulanan', jumlah: 1100000, status: 'likuid' } ],
                pengeluaran: [ { kategori: 'Rutin', item: 'Potong Rambut', anggaran: 40000, catatan: '-' }, { kategori: 'Rutin', item: 'WiFi Bulanan', anggaran: 150000, catatan: 'Prioritas' }, { kategori: 'Investasi', item: 'DCA ke RDPU', anggaran: 200000, catatan: 'Konsisten' }, { kategori: 'Kendaraan', item: 'Perpanjang STNK', anggaran: 250000, catatan: 'Tahunan' } ],
                alokasi: [ { nama: 'Dana Darurat', jumlah: 460000, warna: '#007bff' } ],
                rencanaAksi: [ { judul: 'ðŸŽ¯ Fokus Utama Agustus', poin: ['Selesaikan kewajiban tahunan kendaraan.'] }, { judul: 'ðŸ“ˆ Target September', poin: ['Review keuangan selama setahun.'] } ]
            }
        };

        // --- VARIABEL GLOBAL ---
        let currentMonthIndex = 0;
        const availableMonths = Object.keys(financeData);
        const ctx = document.getElementById('allocationChart').getContext('2d');
        let allocationChart; // Variabel untuk menyimpan instance chart

        // --- FUNGSI-FUNGSI ---
        
        function formatCurrency(amount) {
            // Fungsi untuk memformat angka menjadi format mata uang Rupiah
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
        }

        function parseCurrency(formattedString) {
            // Fungsi untuk mengubah format mata uang (string) kembali menjadi angka
            return Number(String(formattedString).replace(/[^0-9]/g, ''));
        }
        
        function recalculateAndRender() {
            // Fungsi untuk menghitung ulang semua total dan me-render ulang seluruh UI
            const monthKey = availableMonths[currentMonthIndex];
            const data = financeData[monthKey];
            
            const oldSisaKas = (data.dashboard && data.dashboard.sisaKas) ? data.dashboard.sisaKas : 0;

            const totalPemasukanLikuid = data.pemasukan.reduce((sum, item) => item.status === 'likuid' ? sum + item.jumlah : sum, 0);
            const totalPengeluaran = data.pengeluaran.reduce((sum, item) => sum + item.anggaran, 0);
            const sisaKas = totalPemasukanLikuid - totalPengeluaran;

            data.dashboard = {
                pemasukan: totalPemasukanLikuid,
                pemasukanNote: "Data diperbarui secara dinamis.",
                pengeluaran: totalPengeluaran,
                pengeluaranNote: "Data diperbarui secara dinamis.",
                sisaKas: sisaKas,
                sisaKasNote: "Siap dialokasikan."
            };

            const sisaKasDifference = sisaKas - oldSisaKas;
            if (data.alokasi.length > 0) {
                data.alokasi[0].jumlah += sisaKasDifference;
                if (data.alokasi[0].jumlah < 0) data.alokasi[0].jumlah = 0;
            }

            renderUI(monthKey);
        }

        function renderUI(monthKey) {
            // Fungsi untuk "menggambar" semua data ke dalam HTML
            const data = financeData[monthKey];
            
            // --- PEMBARUAN UTAMA: Membuat nama bulan secara otomatis ---
            const [year, month] = monthKey.split('-');
            const date = new Date(year, month - 1);
            const displayMonth = date.toLocaleString('id-ID', { month: 'long', year: 'numeric' });
            document.getElementById('current-month-display').textContent = displayMonth;
            // --- Akhir Pembaruan ---

            document.getElementById('total-pemasukan').textContent = formatCurrency(data.dashboard.pemasukan);
            document.getElementById('pemasukan-note').textContent = data.dashboard.pemasukanNote;
            document.getElementById('total-pengeluaran').textContent = `(${formatCurrency(data.dashboard.pengeluaran)})`;
            document.getElementById('pengeluaran-note').textContent = data.dashboard.pengeluaranNote;
            document.getElementById('sisa-kas').textContent = formatCurrency(data.dashboard.sisaKas);
            document.getElementById('sisa-kas-note').textContent = data.dashboard.sisaKasNote;

            const incomeTableBody = document.getElementById('income-table-body');
            incomeTableBody.innerHTML = '';
            data.pemasukan.forEach((item, index) => {
                const statusClass = `status ${item.status}`;
                const row = `
                    <tr>
                        <td contenteditable="true" data-type="pemasukan" data-index="${index}" data-field="sumber">${item.sumber}</td>
                        <td><input type="text" class="editable-amount" value="${formatCurrency(item.jumlah)}" data-type="pemasukan" data-index="${index}"></td>
                        <td><span class="${statusClass}">${item.status.replace('-', ' ')}</span></td>
                        <td><button class="delete-btn" data-type="pemasukan" data-index="${index}">&#128465;</button></td>
                    </tr>
                `;
                incomeTableBody.innerHTML += row;
            });
            document.getElementById('income-table-foot').innerHTML = `
                <tr>
                    <td>TOTAL KAS LIKUID</td>
                    <td>${formatCurrency(data.dashboard.pemasukan)}</td>
                    <td colspan="2">Siap Digunakan</td>
                </tr>`;
            
            const expenseTableBody = document.getElementById('expense-table-body');
            expenseTableBody.innerHTML = '';
            data.pengeluaran.forEach((item, index) => {
                const row = `
                    <tr>
                        <td contenteditable="true" data-type="pengeluaran" data-index="${index}" data-field="kategori">${item.kategori}</td>
                        <td contenteditable="true" data-type="pengeluaran" data-index="${index}" data-field="item">${item.item}</td>
                        <td><input type="text" class="editable-amount" value="${formatCurrency(item.anggaran)}" data-type="pengeluaran" data-index="${index}"></td>
                        <td contenteditable="true" data-type="pengeluaran" data-index="${index}" data-field="catatan">${item.catatan}</td>
                        <td><button class="delete-btn" data-type="pengeluaran" data-index="${index}">&#128465;</button></td>
                    </tr>
                `;
                expenseTableBody.innerHTML += row;
            });
            document.getElementById('expense-table-foot').innerHTML = `
                <tr>
                    <td colspan="2">TOTAL ANGGARAN PENGELUARAN</td>
                    <td>${formatCurrency(data.dashboard.pengeluaran)}</td>
                    <td colspan="2"></td>
                </tr>`;

            const rencanaAksiSection = document.getElementById('rencana-aksi-section');
            while (rencanaAksiSection.children.length > 1) {
                rencanaAksiSection.removeChild(rencanaAksiSection.lastChild);
            }
            data.rencanaAksi.forEach(item => {
                const sopItem = document.createElement('div');
                sopItem.className = 'sop-item';
                const pointsHtml = item.poin.map(p => `<li>${p}</li>`).join('');
                sopItem.innerHTML = `<h4>${item.judul}</h4><ul>${pointsHtml}</ul>`;
                rencanaAksiSection.appendChild(sopItem);
            });

            updateChart(data.alokasi);
            
            document.getElementById('prev-month-btn').disabled = (currentMonthIndex === 0);
            document.getElementById('next-month-btn').disabled = (currentMonthIndex === availableMonths.length - 1);
        }

        function updateChart(alokasiData) {
            // Fungsi untuk mengupdate atau membuat grafik baru
            if (allocationChart) {
                allocationChart.destroy();
            }
            allocationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: alokasiData.map(item => item.nama),
                    datasets: [{
                        label: 'Alokasi Sisa Kas',
                        data: alokasiData.map(item => item.jumlah),
                        backgroundColor: alokasiData.map(item => item.warna),
                        borderColor: '#ffffff',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true, cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${formatCurrency(context.parsed)}` } }
                    }
                }
            });
        }
        
        // --- HANDLER UNTUK SEMUA AKSI CRUD ---

        function handleTableAction(event) {
            const target = event.target;
            const monthKey = availableMonths[currentMonthIndex];
            const data = financeData[monthKey];

            // UPDATE (Nominal)
            if (target.classList.contains('editable-amount') && event.type === 'change') {
                const index = parseInt(target.dataset.index, 10);
                const newValue = parseCurrency(target.value);
                if (target.dataset.type === 'pemasukan') {
                    data.pemasukan[index].jumlah = newValue;
                } else {
                    data.pengeluaran[index].anggaran = newValue;
                }
                recalculateAndRender();
            }

            // UPDATE (Teks)
            if (target.hasAttribute('contenteditable') && event.type === 'blur') {
                 const index = parseInt(target.dataset.index, 10);
                 const field = target.dataset.field;
                 const newText = target.textContent;
                 if (target.dataset.type === 'pemasukan') {
                    data.pemasukan[index][field] = newText;
                } else {
                    data.pengeluaran[index][field] = newText;
                }
                 // Tidak perlu re-kalkulasi, tapi simpan data (jika ada backend)
            }

            // DELETE
            if (target.classList.contains('delete-btn')) {
                const index = parseInt(target.dataset.index, 10);
                if (confirm('Anda yakin ingin menghapus baris ini?')) {
                    if (target.dataset.type === 'pemasukan') {
                        data.pemasukan.splice(index, 1);
                    } else {
                        data.pengeluaran.splice(index, 1);
                    }
                    recalculateAndRender();
                }
            }
        }

        // --- EVENT LISTENERS ---
        document.getElementById('next-month-btn').addEventListener('click', () => {
            if (currentMonthIndex < availableMonths.length - 1) {
                currentMonthIndex++;
                recalculateAndRender();
            }
        });

        document.getElementById('prev-month-btn').addEventListener('click', () => {
            if (currentMonthIndex > 0) {
                currentMonthIndex--;
                recalculateAndRender();
            }
        });
        
        // CREATE
        document.getElementById('add-income-btn').addEventListener('click', () => {
            const monthKey = availableMonths[currentMonthIndex];
            financeData[monthKey].pemasukan.push({ sumber: 'Sumber Baru', jumlah: 0, status: 'likuid' });
            recalculateAndRender();
        });

        document.getElementById('add-expense-btn').addEventListener('click', () => {
            const monthKey = availableMonths[currentMonthIndex];
            financeData[monthKey].pengeluaran.push({ kategori: 'Kategori Baru', item: 'Item Baru', anggaran: 0, catatan: '-' });
            recalculateAndRender();
        });

        // Event delegation untuk UPDATE dan DELETE
        const container = document.querySelector('.container');
        container.addEventListener('change', handleTableAction); // Untuk nominal
        container.addEventListener('click', handleTableAction); // Untuk tombol delete
        container.addEventListener('blur', handleTableAction, true); // Untuk teks contenteditable


        // --- INISIALISASI ---
        document.addEventListener('DOMContentLoaded', () => {
            recalculateAndRender();
        });
    </script>

</body>
</html>

